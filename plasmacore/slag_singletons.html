<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Content generated by Mediawiki and mw2html -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta http-equiv="Content-Style-Type" content="text/css" />
		<meta name="generator" content="MediaWiki 1.15.1" />
		<meta name="keywords" content="Slag:Singletons,Slag:Data Types" />
		<link rel="shortcut icon" href="http://plasmaworks.com/sites/default/files/sky_favicon.ico" />
		<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Plasmaworks (en)" />
		<link rel="alternate" type="application/rss+xml" title="Plasmaworks RSS Feed" href="" />
		<link rel="alternate" type="application/atom+xml" title="Plasmaworks Atom Feed" href="" />
		<title>Slag:Singletons - Plasmaworks</title>
		<link rel="stylesheet" href="shared.css" type="text/css" media="screen" />
		<link rel="stylesheet" href="commonprint.css" type="text/css" media="print" />
		<link rel="stylesheet" href="main.css" type="text/css" media="screen" />
		<!--[if lt IE 5.5000]><link rel="stylesheet" href="ie50fixes.css" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 5.5000]><link rel="stylesheet" href="ie55fixes.css" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 6]><link rel="stylesheet" href="ie60fixes.css" type="text/css" media="screen" /><![endif]-->
		<!--[if IE 7]><link rel="stylesheet" href="ie70fixes.css" type="text/css" media="screen" /><![endif]-->
		<link rel="stylesheet" href="" type="text/css" />
		<link rel="stylesheet" href="" type="text/css" media="print" />
		<link rel="stylesheet" href="" type="text/css" />
		<link rel="stylesheet" href="" type="text/css" />
		<!--[if lt IE 7]><script type="text/javascript" src="iefixes.js_207"></script>
		<meta http-equiv="imagetoolbar" content="no" /><![endif]-->

		<script type= "text/javascript">/*<![CDATA[*/
		var skin = "monobook";
		var stylepath = "/wiki/skins";
		var wgArticlePath = "/wiki/index.php/$1";
		var wgScriptPath = "/wiki";
		var wgScript = "/wiki/index.php";
		var wgVariantArticlePath = false;
		var wgActionPaths = {};
		var wgServer = "http://www.plasmaworks.com";
		var wgCanonicalNamespace = "";
		var wgCanonicalSpecialPageName = false;
		var wgNamespaceNumber = 0;
		var wgPageName = "Slag:Singletons";
		var wgTitle = "Slag:Singletons";
		var wgAction = "view";
		var wgArticleId = "118";
		var wgIsArticle = true;
		var wgUserName = null;
		var wgUserGroups = null;
		var wgUserLanguage = "en";
		var wgContentLanguage = "en";
		var wgBreakFrames = false;
		var wgCurRevisionId = 571;
		var wgVersion = "1.15.1";
		var wgEnableAPI = true;
		var wgEnableWriteAPI = true;
		var wgSeparatorTransformTable = ["", ""];
		var wgDigitTransformTable = ["", ""];
		var wgRestrictionEdit = [];
		var wgRestrictionMove = [];
		/*]]>*/</script>

		<script type="text/javascript" src="wikibits.js_207"><!-- wikibits js --></script>
		<!-- Head Scripts -->
		<script type="text/javascript" src="ajax.js_207"></script>
		<script type="text/javascript" src=""><!-- site js --></script>
	</head>
<body class="mediawiki ltr ns-0 ns-subject page-Slag_Singletons skin-monobook">
	<div id="globalWrapperHacked">
		<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">Slag:Singletons</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From Plasmaworks</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<p>Singletons are a common design pattern in object-oriented languages, and in Slag they're built-in to the language.  
</p><p>A singleton is where you have global access to a single instance of a given class.  The effect is similar to a class filled with class variables (aka static variables), but singletons are more powerful because you have an object that you can assign to references, implement interfaces through, and so on.
</p><p>Slag has two varieties of singleton: the standard <i>singleton</i> and the <i>deferred singleton</i>.
</p><p><br />
</p>
<table id="toc" class="toc" summary="Contents"><tr><td><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1"><a href="#Standard_Singletons"><span class="tocnumber">1</span> <span class="toctext">Standard Singletons</span></a>
<ul>
<li class="toclevel-2"><a href="#Example_Java_Singleton"><span class="tocnumber">1.1</span> <span class="toctext">Example Java Singleton</span></a></li>
<li class="toclevel-2"><a href="#Example_Slag_Singleton"><span class="tocnumber">1.2</span> <span class="toctext">Example Slag Singleton</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Deferred_Singletons"><span class="tocnumber">2</span> <span class="toctext">Deferred Singletons</span></a>
<ul>
<li class="toclevel-2"><a href="#Example_Java_Deferred_Singleton"><span class="tocnumber">2.1</span> <span class="toctext">Example Java Deferred Singleton</span></a></li>
<li class="toclevel-2"><a href="#Example_Slag_Deferred_Singleton"><span class="tocnumber">2.2</span> <span class="toctext">Example Slag Deferred Singleton</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Tips"><span class="tocnumber">3</span> <span class="toctext">Tips</span></a></li>
<li class="toclevel-1"><a href="#Caveats"><span class="tocnumber">4</span> <span class="toctext">Caveats</span></a></li>
<li class="toclevel-1"><a href="#Singletons_and_Class_Members"><span class="tocnumber">5</span> <span class="toctext">Singletons and Class Members</span></a>
<ul>
<li class="toclevel-2"><a href="#Original_Slag_Program"><span class="tocnumber">5.1</span> <span class="toctext">Original Slag Program</span></a></li>
<li class="toclevel-2"><a href="#Post-processed_Output_Equivalent"><span class="tocnumber">5.2</span> <span class="toctext">Post-processed Output Equivalent</span></a></li>
</ul>
</li>
<li class="toclevel-1"><a href="#Compound_Managers"><span class="tocnumber">6</span> <span class="toctext">Compound Managers</span></a>
<ul>
<li class="toclevel-2"><a href="#Notes"><span class="tocnumber">6.1</span> <span class="toctext">Notes</span></a></li>
</ul>
</li>
</ul>
</td></tr></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="Standard_Singletons" id="Standard_Singletons"></a><h2> <span class="mw-headline"> Standard Singletons </span></h2>
<p>Standard singletons create the singleton object when the program first starts.
</p><p><br />
</p>
<a name="Example_Java_Singleton" id="Example_Java_Singleton"></a><h3> <span class="mw-headline"> Example Java Singleton </span></h3>
<pre> public class ImageCache
 {
   static ImageCache instance = new ImageCache();
 
   HashMap&lt;String,Image&gt; images = new HashMap&lt;String,Image&gt;();
 
   public Image get( String filename ) { ... }
 }
 ...
 Image img = ImageCache.instance.get("laser.png")
</pre>
<p><br />
</p>
<a name="Example_Slag_Singleton" id="Example_Slag_Singleton"></a><h3> <span class="mw-headline"> Example Slag Singleton </span></h3>
<pre> singleton class ImageCache
   PROPERTIES
     images()&nbsp;: HashTable&lt;&lt;String,Image&gt;&gt;
 
   METHODS
     method get( String filename ).Image: ...
 endClass
 ...
 local var img = ImageCache["laser.png"]
</pre>
<p><br />
</p>
<a name="Deferred_Singletons" id="Deferred_Singletons"></a><h2> <span class="mw-headline"> Deferred Singletons </span></h2>
<p>With a deferred singleton, the singleton object is created when the singleton is first accessed.  This is necessary when a singleton's initialization will access resources that may not be available or initialized at the very beginning of a program.
</p>
<a name="Example_Java_Deferred_Singleton" id="Example_Java_Deferred_Singleton"></a><h3> <span class="mw-headline"> Example Java Deferred Singleton </span></h3>
<pre> public class ImageCache
 {
   static ImageCache instance;
   static ImageCache getInstance()
   {
     if (instance == null) instance = new ImageCache()
     return instance;
   }
 
   HashMap&lt;String,Image&gt; images = new HashMap&lt;String,Image&gt;();
 
   public Image get( String filename ) { ... }
 }
 ...
 Image img = ImageCache.getInstance().get("laser.png")
</pre>
<p><br />
</p>
<a name="Example_Slag_Deferred_Singleton" id="Example_Slag_Deferred_Singleton"></a><h3> <span class="mw-headline"> Example Slag Deferred Singleton </span></h3>
<pre> deferred singleton class ImageCache
   PROPERTIES
     images()&nbsp;: HashTable&lt;&lt;String,Image&gt;&gt;
 
   METHODS
     method get( String filename ).Image: ...
 endClass
 ...
 local var img = ImageCache["laser.png"]
</pre>
<a name="Tips" id="Tips"></a><h2> <span class="mw-headline"> Tips </span></h2>
<ul><li> Singletons don't have to have an <i>init()</i> method defined, but if they <i>do</i> then that method is called when the singleton is created.
</li></ul>
<ul><li> The name of a singleton is a reference to it, e.g. "local ImageCache cache = ImageCache".
</li></ul>
<ul><li> Singletons can be set to reference a new object by assigning to their name: "ImageCache = ImageCache(new_params)".
</li></ul>
<ul><li> Extended singletons aren't automatically singletons, and likewise extended classes can be singletons whether or not the originals are.  For example:
</li></ul>
<pre> singleton class Names&nbsp;: String[];
 ...
 Names.add("Abe")
 Names.add("Ty")
 Names.clear
</pre>
<p><br />
</p>
<a name="Caveats" id="Caveats"></a><h2> <span class="mw-headline"> Caveats </span></h2>
<ul><li> An initializer method with a default parameter (for example, "init(Int32 capacity=10)") will <b>not</b> be called when a singleton is created.  Only an <i>init()</i> method with no parameters will be called.
</li></ul>
<ul><li> Initialization of a singleton containing code that recursively references the singleton will likely produce an error.  Singleton references are not properly set until <b>after</b> their initialization code returns.  For example:
</li></ul>
<pre> deferred singleton class World
   monsters()&nbsp;: Monster[]
   hero()    &nbsp;: Hero
 endClass
 
 class Hero
   PROPERTIES
     monsters&nbsp;: Monster[]
   METHODS
     method init:
       monsters = World.monsters
 endClass
 
 # This code produces an infinite recursion. The first reference to World
 # will create a new World object, which creates a new Hero, which tries
 # to access World - but World isn't finished setting up yet and the
 # internal singleton reference is null!  World tries to set up again
 # (recursively), which creates a new Hero, etc.
 #
 # One way to fix this would be to move the hero instantiation into a
 # separate method so it's not performed as World is initialized:
 #
 #     hero&nbsp;: Hero
 #   METHODS
 #     method set_up:
 #       hero = Hero()
 #   ...
 #   World.set_up  # instantiates World and then calls set_up
</pre>
<a name="Singletons_and_Class_Members" id="Singletons_and_Class_Members"></a><h2> <span class="mw-headline"> Singletons and Class Members </span></h2>
<p>While most languages implement singletons through class members (aka static variables and methods), Slag implements class members through singletons.  Slag doesn't truly have such a thing as a class member - class members definitions are placed into separate singletons that become implicit context for resolving member access.
</p><p><br />
</p>
<a name="Original_Slag_Program" id="Original_Slag_Program"></a><h3> <span class="mw-headline"> Original Slag Program </span></h3>
<pre> class SomeDataStructure
   CLASS_PROPERTIES
     default_capacity=10&nbsp;: Int32
 
   PROPERTIES  
     capacity&nbsp;: Int32
 
   METHODS
     method init:
       capacity = default_capacity
     ...
 endClass
</pre>
<p><br />
</p>
<a name="Post-processed_Output_Equivalent" id="Post-processed_Output_Equivalent"></a><h3> <span class="mw-headline"> Post-processed Output Equivalent </span></h3>
<pre> singleton class SomeDataStructureManager
   PROPERTIES
     default_capacity=10&nbsp;: Int32
 endClass
 
 class SomeDataStructure
   SINGLETONS
     SomeDataStructureManager
 
   PROPERTIES
     capacity&nbsp;: Int32
 
   METHODS
     method init:
       capacity = SomeDataStructureManager.default_capacity
 endClass
</pre>
<p><br />
</p>
<a name="Compound_Managers" id="Compound_Managers"></a><h2> <span class="mw-headline"> Compound Managers </span></h2>
<p><a href="slag_data_types.html#Compounds" title="Slag:Data Types">Compounds</a> cannot contain methods, but a singleton may be used in conjunction with a compound to fake it.
</p><p>If a compound such as the following is declared:
</p>
<pre> compound Vector2( Real64 x, Real64 y )
</pre>
<p>and it is used as the context of a call:
</p>
<pre> local Vector2 v(3,4)
 println( v.magnitude )
</pre>
<p>Then the Slag compiler will automatically transform the call to have singleton context "Vector2Manager", inserting the compound as the first parameter:
</p>
<pre> println( Vector2Manager.magnitude(v) )
</pre>
<p>The actual method definition would look like this:
</p>
<pre> class Vector2Manager
   method magnitude( Vector2 v ).Real64:
     return sqrt(v.x*v.x + v.y*v.y)
 endClass
</pre>
<a name="Notes" id="Notes"></a><h3> <span class="mw-headline"> Notes </span></h3>
<ul><li> The same trick works with primitives so long as a compatible method is declared in class Global.  For instance, "i.clamped(1,10)" becomes "Global.clamped(i,1,10)".
</li></ul>
<ul><li> Add "create_from(...)" methods into a compound manager to act as alternate initalizers.  For example:
</li></ul>
<pre> class Vector2Manager
   method create_from( Real64 r, Radians angle ).Vector2:
     return Vector2(r*cos(angle),r*sin(angle))
 endClass
 ...
 local Vector2 v1(3,4)
   # Directly creates a Vector2 compound
 
 local Vector2 v2(5,Radians(0.927))
   # Same as:
   #   local Vector2 v2 = Vector2Manager.create_from(5,Radians(0.927))
</pre>
<!-- 
NewPP limit report
Preprocessor node count: 14/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key pw_mediawiki_user:pcache:idhash:118-0!1!0!!en!2!edit=0 and timestamp 20120628114230 -->
<div class="printfooter">
Retrieved from "<a href="">http://www.plasmaworks.com/wiki/index.php/Slag:Singletons</a>"</div>
						<!-- end content --><div class="visualClear"></div></div></div></div>
    <div id="column-one">
      <div id="p-cactions" class="portlet"></div>
      <div class="portlet" id="p-personal"></div>
      <div class="portlet" id="p-logo"></div>
      <div class="portlet" id="p-nav">
  
      </div>
      <div id="p-search" class="portlet"></div>
      <div class="portlet" id="p-tb"></div>
    </div>
    <!-- end left column -->
  <!-- end of the left (by default at least) column -->
			<div class="visualClear"></div>
			<div id="footerHacked">
				<ul id="f-list">
					<li id="lastmod"> This page was last modified on 12 May 2010, at 05:37.</li>
					<li id="viewcount">This page has been accessed 1,134 times.</li>
					<li id="privacy"><a href="plasmaworks_privacy_policy.html" title="Plasmaworks:Privacy policy">Privacy policy</a></li>
					<li id="about"><a href="plasmaworks_about.html" title="Plasmaworks:About">About Plasmaworks</a></li>
					<li id="disclaimer"><a href="plasmaworks_general_disclaimer.html" title="Plasmaworks:General disclaimer">Disclaimers</a></li>
			</ul>
		</div>
</div>

		<script type="text/javascript">if (window.runOnloadHook) runOnloadHook();</script>
<!-- Served in 0.294 secs. --><br></body></html>
